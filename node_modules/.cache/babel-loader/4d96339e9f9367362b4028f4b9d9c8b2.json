{"ast":null,"code":"import axios from 'axios';\nexport default {\n  name: \"Pago\",\n\n  data() {\n    return {\n      carrito: {\n        items: []\n      },\n      stripe: {},\n      card: {},\n      nombre: '',\n      apellido: '',\n      correo: '',\n      telefono: '',\n      direccion: '',\n      errors: []\n    };\n  },\n\n  mounted() {\n    document.title = 'Pago | Cesfam';\n    this.carrito = this.$store.state.carrito;\n\n    if (this.cartTotalLength > 0) {\n      this.stripe = Stripe('pk_test_51Kze1cEGaM7Rr8Bph1nssQsm5c9DqVeKN96DRlI9OME9x4UBSQESI2V97nc5rbfbSFu4RmhfmgijOMBTJR9hebfD0016DqwRlz');\n      const elements = this.stripe.elements();\n      this.card = elements.create('card', {\n        hidePostalCode: true\n      });\n      this.card.mount('#card-element');\n    }\n  },\n\n  methods: {\n    getItemTotal(item) {\n      return item.quantity * item.remedio.precioRemedio;\n    },\n\n    submitForm() {\n      this.errors = [];\n      this.stripe = Stripe('pk_test_51Kze1cEGaM7Rr8Bph1nssQsm5c9DqVeKN96DRlI9OME9x4UBSQESI2V97nc5rbfbSFu4RmhfmgijOMBTJR9hebfD0016DqwRlz');\n\n      if (this.nombre === '') {\n        this.errors.push('Ingrese el nombre');\n      }\n\n      if (this.apellido === '') {\n        this.errors.push('Ingrese el apellido');\n      }\n\n      if (this.correo === '') {\n        this.errors.push('Ingrese el correo');\n      }\n\n      if (this.telefono === '') {\n        this.errors.push('Ingrese el telefono');\n      }\n\n      if (this.direccion === '') {\n        this.errors.push('Ingrese la dirección');\n      }\n\n      if (!this.errors.length) {\n        console.log(\"setIsLoading\");\n        this.stripe.createToken(this.card).then(result => {\n          if (result.error) {\n            this.errors.push(\"Algo salio mal con stripe. Vuelve a intentarlo\");\n            console.log(result.error.message);\n          } else {\n            this.stripeTokenHandler(result.token);\n          }\n        });\n      }\n    },\n\n    stripeTokenHandler(token) {\n      const items = [];\n\n      for (let i = 0; i < this.carrito.items.length; i++) {\n        const item = this.carrito.items[i];\n        const obj = {\n          remedio: item.remedio.id,\n          quantity: item.quantity,\n          precio: item.remedio.precioRemedio * item.quantity\n        };\n        items.push(obj);\n      }\n\n      const data = {\n        'nombre': this.nombre,\n        'apellido': this.apellido,\n        'correo': this.correo,\n        'direccion': this.direccion,\n        'telefono': this.telefono,\n        'items': items,\n        'stripe_token': token.id\n      };\n      axios.post('/api/v1/cobro/', data).then(response => {\n        this.$store.commit('clearCart');\n        this.$router.push('/carrito/pago_finalizado');\n      }).catch(error => {\n        this.errors.push('Algo salio mal. Vuelvelo a intentar');\n        console.log(error);\n      });\n    }\n\n  },\n  computed: {\n    cartTotalLength() {\n      return this.carrito.items.reduce((acc, curVal) => {\n        ///la funcion reduce() de js nos permite hacer un loop en todos los items del carrito, para asi poder incrementar el valor\n        return acc += curVal.quantity;\n      }, 0);\n    },\n\n    cartTotalPrice() {\n      return this.carrito.items.reduce((acc, curVal) => {\n        ///la funcion reduce() de js nos permite hacer un loop en todos los items del carrito, para asi poder incrementar el valor o el largo del carrito\n        return acc += curVal.remedio.precioRemedio * curVal.quantity;\n      }, 0);\n    }\n\n  }\n};","map":{"version":3,"mappings":"AAqGA,OAAOA,KAAP,MAAkB,OAAlB;AACA,eAAe;EACXC,IAAI,EAAE,MADK;;EAEXC,IAAI,GAAG;IACH,OAAO;MACHC,OAAO,EAAE;QACLC,KAAK,EAAE;MADF,CADN;MAIHC,MAAM,EAAE,EAJL;MAKHC,IAAI,EAAE,EALH;MAMHC,MAAM,EAAE,EANL;MAOHC,QAAQ,EAAE,EAPP;MAQHC,MAAM,EAAE,EARL;MASHC,QAAQ,EAAE,EATP;MAUHC,SAAS,EAAE,EAVR;MAWHC,MAAM,EAAE;IAXL,CAAP;EAaH,CAhBU;;EAiBXC,OAAO,GAAG;IACNC,QAAQ,CAACC,KAAT,GAAiB,eAAjB;IAEA,KAAKZ,OAAL,GAAe,KAAKa,MAAL,CAAYC,KAAZ,CAAkBd,OAAjC;;IAEA,IAAI,KAAKe,eAAL,GAAuB,CAA3B,EAA6B;MACzB,KAAKb,MAAL,GAAcc,MAAM,CAAC,6GAAD,CAApB;MACA,MAAMC,QAAO,GAAI,KAAKf,MAAL,CAAYe,QAAZ,EAAjB;MACA,KAAKd,IAAL,GAAYc,QAAQ,CAACC,MAAT,CAAgB,MAAhB,EAAwB;QAAEC,cAAc,EAAE;MAAlB,CAAxB,CAAZ;MAEA,KAAKhB,IAAL,CAAUiB,KAAV,CAAgB,eAAhB;IACJ;EACH,CA7BU;;EA8BXC,OAAO,EAAE;IACLC,YAAY,CAACC,IAAD,EAAM;MACd,OAAOA,IAAI,CAACC,QAAL,GAAgBD,IAAI,CAACE,OAAL,CAAaC,aAApC;IACH,CAHI;;IAILC,UAAU,GAAE;MACR,KAAKlB,MAAL,GAAc,EAAd;MACA,KAAKP,MAAL,GAAcc,MAAM,CAAC,6GAAD,CAApB;;MAEA,IAAI,KAAKZ,MAAL,KAAgB,EAApB,EAAuB;QACnB,KAAKK,MAAL,CAAYmB,IAAZ,CAAiB,mBAAjB;MACJ;;MAEA,IAAI,KAAKvB,QAAL,KAAkB,EAAtB,EAAyB;QACrB,KAAKI,MAAL,CAAYmB,IAAZ,CAAiB,qBAAjB;MACJ;;MAEA,IAAI,KAAKtB,MAAL,KAAgB,EAApB,EAAuB;QACnB,KAAKG,MAAL,CAAYmB,IAAZ,CAAiB,mBAAjB;MACJ;;MAEA,IAAI,KAAKrB,QAAL,KAAkB,EAAtB,EAAyB;QACrB,KAAKE,MAAL,CAAYmB,IAAZ,CAAiB,qBAAjB;MACJ;;MAEA,IAAI,KAAKpB,SAAL,KAAmB,EAAvB,EAA0B;QACtB,KAAKC,MAAL,CAAYmB,IAAZ,CAAiB,sBAAjB;MACJ;;MAEA,IAAI,CAAC,KAAKnB,MAAL,CAAYoB,MAAjB,EAAyB;QACrBC,OAAO,CAACC,GAAR,CAAY,cAAZ;QAEA,KAAK7B,MAAL,CAAY8B,WAAZ,CAAwB,KAAK7B,IAA7B,EAAmC8B,IAAnC,CAAwCC,MAAK,IAAI;UAC7C,IAAIA,MAAM,CAACC,KAAX,EAAkB;YACd,KAAK1B,MAAL,CAAYmB,IAAZ,CAAiB,gDAAjB;YAEAE,OAAO,CAACC,GAAR,CAAYG,MAAM,CAACC,KAAP,CAAaC,OAAzB;UACH,CAJD,MAIM;YACF,KAAKC,kBAAL,CAAwBH,MAAM,CAACI,KAA/B;UACJ;QACH,CARD;MASJ;IAGH,CA3CI;;IA4CLD,kBAAkB,CAACC,KAAD,EAAO;MACrB,MAAMrC,KAAI,GAAI,EAAd;;MAEA,KAAK,IAAIsC,IAAI,CAAb,EAAgBA,IAAI,KAAKvC,OAAL,CAAaC,KAAb,CAAmB4B,MAAvC,EAA+CU,CAAC,EAAhD,EAAmD;QAC/C,MAAMhB,IAAG,GAAI,KAAKvB,OAAL,CAAaC,KAAb,CAAmBsC,CAAnB,CAAb;QACA,MAAMC,GAAE,GAAI;UACRf,OAAO,EAAEF,IAAI,CAACE,OAAL,CAAagB,EADd;UAERjB,QAAQ,EAAED,IAAI,CAACC,QAFP;UAGRkB,MAAM,EAAEnB,IAAI,CAACE,OAAL,CAAaC,aAAb,GAA6BH,IAAI,CAACC;QAHlC,CAAZ;QAKAvB,KAAK,CAAC2B,IAAN,CAAWY,GAAX;MACJ;;MAEA,MAAMzC,IAAG,GAAI;QACT,UAAU,KAAKK,MADN;QAET,YAAY,KAAKC,QAFR;QAGT,UAAU,KAAKC,MAHN;QAIT,aAAa,KAAKE,SAJT;QAKT,YAAY,KAAKD,QALR;QAMT,SAASN,KANA;QAOT,gBAAgBqC,KAAK,CAACG;MAPb,CAAb;MAUA5C,KAAI,CACC8C,IADL,CACU,gBADV,EAC4B5C,IAD5B,EAEKkC,IAFL,CAEUW,QAAO,IAAK;QACd,KAAK/B,MAAL,CAAYgC,MAAZ,CAAmB,WAAnB;QACA,KAAKC,OAAL,CAAalB,IAAb,CAAkB,0BAAlB;MACH,CALL,EAMKmB,KANL,CAMWZ,KAAI,IAAK;QACZ,KAAK1B,MAAL,CAAYmB,IAAZ,CAAiB,qCAAjB;QAEAE,OAAO,CAACC,GAAR,CAAYI,KAAZ;MACH,CAVL;IAWH;;EA9EI,CA9BE;EA8GXa,QAAQ,EAAE;IACNjC,eAAe,GAAE;MACb,OAAO,KAAKf,OAAL,CAAaC,KAAb,CAAmBgD,MAAnB,CAA0B,CAACC,GAAD,EAAMC,MAAN,KAAiB;QAAE;QAChD,OAAOD,GAAE,IAAKC,MAAM,CAAC3B,QAArB;MACH,CAFM,EAEJ,CAFI,CAAP;IAGH,CALK;;IAMN4B,cAAc,GAAE;MACZ,OAAO,KAAKpD,OAAL,CAAaC,KAAb,CAAmBgD,MAAnB,CAA0B,CAACC,GAAD,EAAMC,MAAN,KAAiB;QAAE;QAChD,OAAOD,GAAE,IAAKC,MAAM,CAAC1B,OAAP,CAAeC,aAAf,GAA+ByB,MAAM,CAAC3B,QAApD;MACH,CAFM,EAEJ,CAFI,CAAP;IAGH;;EAVK;AA9GC,CAAf","names":["axios","name","data","carrito","items","stripe","card","nombre","apellido","correo","telefono","direccion","errors","mounted","document","title","$store","state","cartTotalLength","Stripe","elements","create","hidePostalCode","mount","methods","getItemTotal","item","quantity","remedio","precioRemedio","submitForm","push","length","console","log","createToken","then","result","error","message","stripeTokenHandler","token","i","obj","id","precio","post","response","commit","$router","catch","computed","reduce","acc","curVal","cartTotalPrice"],"sourceRoot":"","sources":["/Users/franciscosantander/Desktop/Cesfam/cesfam_vue/src/views/Pago.vue"],"sourcesContent":["<template>\n    <div class=\"page-pago\">\n        <div class=\"columns is-multiline\">\n            <h1 class=\"title\">Proceso de pago</h1>\n        </div>\n\n        <div class=\"column is-12 box\">\n            <table class=\"table is-fullwidth\">\n                <thead>\n                    <tr>\n                        <th>Remedios</th>\n                        <th>Precio</th>\n                        <th>Cantidad</th>\n                        <th>Total</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    <tr\n                    v-for=\"item in carrito.items\"\n                    v-bind:key=\"item.remedio.id\">\n\n                        <th>{{ item.remedio.nombreRemedio }}</th>\n                        <th>{{ item.remedio.precioRemedio }}</th>\n                        <th>{{ item.quantity }}</th>\n                        <th>{{ getItemTotal(item) }}</th>\n\n                    </tr>\n                </tbody>\n\n                <tfoot>\n                    <tr>\n                        <td colspan=\"2\">Total</td>\n                        <td>{{ cartTotalLength }}</td>\n                        <td>${{ cartTotalPrice }}</td>\n                    </tr>\n                </tfoot>\n            </table>\n        </div>\n\n        <div class=\"column is-12 box\">\n                <h2 class=\"subtitle\">detalles del envio</h2>\n                <div class=\"columns is-multiline\">\n                    <div class=\"column is-6\">\n                        <div class=\"field\">\n                            <label>Nombre</label>\n                            <div class=\"control\">\n                                <input type=\"text\" class=\"input\" v-model=\"nombre\">\n                            </div>\n                        </div>\n\n                        <div class=\"field\">\n                            <label>Apellido</label>\n                            <div class=\"control\">\n                                <input type=\"text\" class=\"input\" v-model=\"apellido\">\n                            </div>\n                        </div>\n\n                        <div class=\"field\">\n                            <label>Correo</label>\n                            <div class=\"control\">\n                                <input type=\"email\" class=\"input\" v-model=\"correo\">\n                            </div>\n                        </div>\n\n                        <div class=\"field\">\n                            <label>Teléfono</label>\n                            <div class=\"control\">\n                                <input type=\"text\" class=\"input\" v-model=\"telefono\">\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class=\"column is-6\">\n                        <div class=\"field\">\n                            <label>Dirección</label>\n                            <div class=\"control\">\n                                <input type=\"text\" class=\"input\" v-model=\"direccion\">\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <div class=\"notification is-danger mt-4\" v-if=\"errors.length\">\n                    <p v-for=\"error in errors\" v-bind:key=\"error\">{{ error }}</p>\n                </div>\n\n                <hr>\n\n                <div id=\"card-element\" class=\"mb-5\"></div>\n\n                <template v-if=\"cartTotalLength\">\n                    <hr>\n\n                    <button class=\"button is-dark\" @click=\"submitForm\">Pagar</button>\n                </template>\n\n        </div>   \n    </div>\n</template>\n\n<script>\nimport axios from 'axios'\nexport default {\n    name: \"Pago\",\n    data() {\n        return {\n            carrito: {\n                items: []\n            },\n            stripe: {},\n            card: {},\n            nombre: '',\n            apellido: '',\n            correo: '',\n            telefono: '',\n            direccion: '',\n            errors: [],\n        }\n    },\n    mounted() {\n        document.title = 'Pago | Cesfam'\n\n        this.carrito = this.$store.state.carrito\n\n        if (this.cartTotalLength > 0){\n            this.stripe = Stripe('pk_test_51Kze1cEGaM7Rr8Bph1nssQsm5c9DqVeKN96DRlI9OME9x4UBSQESI2V97nc5rbfbSFu4RmhfmgijOMBTJR9hebfD0016DqwRlz')\n            const elements = this.stripe.elements();\n            this.card = elements.create('card', { hidePostalCode: true })\n\n            this.card.mount('#card-element')\n        }\n    },\n    methods: {\n        getItemTotal(item){\n            return item.quantity * item.remedio.precioRemedio\n        },\n        submitForm(){\n            this.errors = []\n            this.stripe = Stripe('pk_test_51Kze1cEGaM7Rr8Bph1nssQsm5c9DqVeKN96DRlI9OME9x4UBSQESI2V97nc5rbfbSFu4RmhfmgijOMBTJR9hebfD0016DqwRlz')\n\n            if (this.nombre === ''){\n                this.errors.push('Ingrese el nombre')\n            }\n\n            if (this.apellido === ''){\n                this.errors.push('Ingrese el apellido')\n            }\n\n            if (this.correo === ''){\n                this.errors.push('Ingrese el correo')\n            }\n\n            if (this.telefono === ''){\n                this.errors.push('Ingrese el telefono')\n            }\n\n            if (this.direccion === ''){\n                this.errors.push('Ingrese la dirección')\n            }\n\n            if (!this.errors.length) {\n                console.log(\"setIsLoading\")\n\n                this.stripe.createToken(this.card).then(result =>{\n                    if (result.error) {\n                        this.errors.push(\"Algo salio mal con stripe. Vuelve a intentarlo\")\n\n                        console.log(result.error.message)\n                    }else {\n                        this.stripeTokenHandler(result.token)\n                    }\n                })\n            }\n\n\n        },\n        stripeTokenHandler(token){\n            const items = []\n\n            for (let i = 0; i < this.carrito.items.length; i++){\n                const item = this.carrito.items[i]\n                const obj = {\n                    remedio: item.remedio.id,\n                    quantity: item.quantity,\n                    precio: item.remedio.precioRemedio * item.quantity \n                }\n                items.push(obj)\n            }\n\n            const data = {\n                'nombre': this.nombre,\n                'apellido': this.apellido,\n                'correo': this.correo,\n                'direccion': this.direccion,\n                'telefono': this.telefono,\n                'items': items,\n                'stripe_token': token.id\n            }\n\n            axios\n                .post('/api/v1/cobro/', data)\n                .then(response => {\n                    this.$store.commit('clearCart')\n                    this.$router.push('/carrito/pago_finalizado')\n                })\n                .catch(error => {\n                    this.errors.push('Algo salio mal. Vuelvelo a intentar')\n\n                    console.log(error)\n                })\n        },\n    },\n    computed: {\n        cartTotalLength(){\n            return this.carrito.items.reduce((acc, curVal) => { ///la funcion reduce() de js nos permite hacer un loop en todos los items del carrito, para asi poder incrementar el valor\n                return acc += curVal.quantity\n            }, 0)\n        },\n        cartTotalPrice(){\n            return this.carrito.items.reduce((acc, curVal) => { ///la funcion reduce() de js nos permite hacer un loop en todos los items del carrito, para asi poder incrementar el valor o el largo del carrito\n                return acc += curVal.remedio.precioRemedio * curVal.quantity\n            }, 0)\n        },\n    }\n}\n</script>"]},"metadata":{},"sourceType":"module"}